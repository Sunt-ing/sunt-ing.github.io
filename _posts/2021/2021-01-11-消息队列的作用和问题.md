 

### 消息队列的作用：为什么要使用消息队列而不直接连接生产者和消费者？

#### 解耦

让生产者和消费者都依赖于公共的第三方组件，而非二者直接相连，可以在业务逻辑频繁变动时防止整个系统陷入混乱。

比方说，我们现在有两个生产者A、B和几个消费者B、C、D等通过网络报文发送直接相连。那么，如果此时C不需要这个消息了，我们就要改A的逻辑代码了；如果这时D需要A的消息，那么我们需要再次调整A的代码；如果后面C需要B的消息，我们还得调整B的代码。长此以往，整个系统的维护复杂度非常高，很容易出错。

另外，使用消息队列可以让我们把失败重发等网络传输处理逻辑交由中间件来处理，减轻业务层的压力。

#### 异步

比方说，用户和生产者A相连，A和消费者B、C、D相连，那么如果客户端发送了一条消息给A，那么A必须同时给B、C、D发送成功才能告知用户处理完成，链路延时很长，用户的使用体验非常糟糕。如果使用消息队列来解耦，那么A只需要把消息发给消息队列就可以了，然后消费者异步消费消息，这样用户感觉消息很快就处理完了，用户体验++。

#### 削峰

比如我们要把日志写入 ElasticSearch，但是白天时日志的生产量很大，而晚上时生产量又非常小，如果不使用消息队列，那么要么部署一个较大的ElasticSearch集群以处理白天较大的消息量，但是这样的话晚上整个集群就闲置了，造成资源浪费。要么部署一个较小的集群，然后白天时整个集群被压垮。如果使用一个消息队列来解耦二者，那么即使生产者的日志生产量波动较大，也能使得消费者（ElasticSearch）的消费较为平稳。



### 消息队列的缺点：引入消息队列有什么潜在的问题？

#### 降低系统的可用度

引入消息队列后，整个系统的变量增加了，那么如果消息队列挂了该怎么办？所以，引入了消息队列后我们还得确保消息队列的高可用性。

#### 引入了一致性问题

生产者A把消息发送给消息队列后就直接返回给用户了，但是如果这时三个消费者中B消费成功了，而C、D消费失败了，则引入了不一致性的问题。











