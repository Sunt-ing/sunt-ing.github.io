## 常见问题

#### 如何从大量的 URL 中找出相同的 URL？

- 问题：给定 a、b 两个文件，各存放 50 亿个 URL，每个 URL 各占 64B，内存限制是 4G。请找出 a、b 两个文件共同的 URL。

- 解法：a、b每个文件都有320G大小，显然内存中无法存下。所以可以采用分治法，先将a、b里的所有URL分别哈希到1000个文件中，总共2000个文件，每个文件的大小应该都在0.32G左右，如果哈希函数正常，应该不会出现大的数据倾斜。然后每次都取出对应的两个文件，先将其中一个文件中所有的URL都存成一个hashset，然后遍历另一个文件中的所有的URL，看看在hashset中是否存在。

#### 如何从大量数据中找出高频词？

- 问题：有一个 1GB 大小的文件，文件里每一行是一个词，每个词的大小不超过 16B，内存大小限制是 1MB，要求返回频数最高的 100 个词 (Top 100)。

- 解法：为了确保处理的数据量小于1MB，我们要采用分治的方法，把文件中的所有词hash到5000个文件中，记录每一个词出现的次数，以K，V的形式存到文件中。然后使用一个大小为100的小顶堆遍历所有KV，找出词频最大的100个词 。

#### 如何找出某一天访问百度网站最多的 IP？

- 问题：现有海量日志数据保存在一个超大文件中，该文件无法直接读入内存，要求从中提取某天访问百度次数最多的那个 IP。

- 解法：将文件哈希到许多小文件中，统计每一个IP出现的次数，遍历找出访问最多的那个IP。

#### 如何在大量的数据中找出不重复的整数？

- 问题：在 2.5 亿个整数中找出不重复的整数。注意：内存不足以容纳这 2.5 亿个整数。
  - 解法：将所有数字哈希到许多小文件中，然后如法炮制。

- 变种：在 40 亿个整数中找出不重复的整数。注意：内存不足以容纳这 40 亿个整数。
  - 解法：可以采用位图法。我们需要两个bit来表示一个数字的出现次数，0，1，多次。假设数字是int，位图所占的内存为 2*2 ^ 32  bit=1GB，可以完成计算。

- 类似问题：如何统计不同电话号码的个数？

#### 如何在大量的数据中判断一个数是否存在？

- 问题：给定 40 亿个不重复的没排过序的 unsigned int 型整数，然后再给定一个数，如何快速判断这个数是否在这 40 亿个整数当中？

- 解法一：分治法。

- 解法二：位图法。位图法可以大量地用于判断是否重复、是否存在等问题上。

#### 如何查询最热门的查询串？

- 问题：有 1000w 个查询串，每个查询串的长度不超过 255 字节，去重后数量不超过 300w 个。请统计最热门的 10 个查询串，要求使用的内存不能超过 1G。

- 解法一：分治法。

- 解法二：HashMap法。注意到255* 3* 10^6=0.765* 10^9=0.75G < 1G
  - 所以可以使用hashmap来直接计算词频，然后使用小顶堆来找Top 10。

- 解法三：前缀树法。对于字符串的查找和统计词频，也经常用前缀树。

#### 如何从 5 亿个数中找出中位数？

- 问题：从 5 亿个数中找出中位数。

- 解法一：大小堆。一个大顶堆，一个小顶堆，大顶堆中所有的元素都小于小顶堆中的元素，如果总元素数是奇数，则令大顶堆中的元素数比小顶堆的多一个。否则令二者元素数相同。每次看到一个新元素时，如果加上这个元素后总元素数是奇数，则把这个元素加入小顶堆，然后将当前的小顶堆堆顶的元素pop到大顶堆中。否则，将这个元素加入大顶堆，然后将大顶堆的堆顶元素加入到小顶堆中。

  > - 见 LeetCode No.295：https://leetcode.com/problems/find-median-from-data-stream/

- 解法二：分治法。实现一个函数，能从一个文件的所有数字中找到第n大的：先根据最高位是否为1将所有数字分成两个部分f0和f1，然后我们要找的全局中位数就在包含数字较多的文件中，是它的第n大的数字，算出n，然后递归找到这个数字。如果我们要找的数字恰好横跨这两个文件，则从f0中找最大的数字，从f1中找最小的数字，取二者之平均值。

#### 如何按照 query 的频度排序？

- 问题：有 10 个文件，每个文件大小为 1G，每个文件的每一行存放的都是用户的 query，每个文件的 query 都可能重复。要求按照 query 的频度排序
- 解法
  - 如果query的重复度较高：则将其全部读入内存，使用HashMap统计词频，然后快排
  - 如果query的重复度不高：将所有的query哈希重新划分到不同的文件中。使用HashMap统计词频，排序，覆写回文件。然后使用归并各个（频率-词项）pair

#### 如何找出排名前 500 的数？

- 题目：有 20 个数组，每个数组有 500 个元素，并且有序排列。如何在这 20*500 个数中找出前 500 的数？
- 解法：堆排序



## 方法总结

总结一下几种常见套路：

- 分治法：先哈希到不同的文件中，然后分别处理，再合并各个文件的结果
- HashMap法：如果内存顶得住，则直接把（词项，词频）等pair放在HashMap中
- 堆排序：大顶堆、小顶堆来找到Top K
- 位图法：如果内存顶得住，那么可以使用位图法来解决词频、词项的存在性等问题















